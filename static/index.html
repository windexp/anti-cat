<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Cat 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen font-sans antialiased">
    <div id="app" v-cloak>
        <!-- 사이드바 (push 방식) -->
        <aside
            class="fixed left-0 top-0 z-50 h-full bg-slate-50 transform transition-all duration-300"
            :class="isSidebarOpen ? 'w-72' : 'w-16'">

            <!-- Sidebar content (nav 높이만큼 여백) -->
            <div class="pt-6 px-3 pb-6 space-y-8 h-full overflow-y-auto">

                <!-- 브랜드 / 토글 버튼 -->
                <button 
                    @click="isSidebarOpen = !isSidebarOpen"
                    class="w-full text-left px-3 py-2 rounded-lg hover:bg-white transition-all group"
                    :aria-label="isSidebarOpen ? 'Close sidebar' : 'Open sidebar'">
                    <h1 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-cat text-blue-600 transition-all" :class="isSidebarOpen ? 'mr-2' : 'mx-auto'"></i>
                        <span v-if="isSidebarOpen" class="bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">AntiCat</span>
                    </h1>
                </button>

                <!-- 작업 섹션 -->
                <div v-if="isSidebarOpen" class="space-y-2">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">
                        Execition
                    </h3>
                    <button @click="triggerDailyRoutine" 
                            class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center group">
                        <i class="fas fa-play mr-3 text-slate-500 group-hover:text-slate-700 transition-transform group-hover:scale-110"></i>
                        <span>Daily Routine</span>
                    </button>
                </div>

                <!-- 데이터 관리 섹션 -->
                <div v-if="isSidebarOpen" class="space-y-2">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">
                        Data Management<Main></Main>
                    </h3>
                    <div class="space-y-1">
                        <button @click="exportDataset" 
                                class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center group">
                            <i class="fas fa-download mr-3 text-slate-500 group-hover:text-slate-700 transition-colors"></i>
                            <span>Export</span>
                        </button>
                        <button @click="regenerateLabels" 
                                :disabled="labelRegenerating"
                                class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center disabled:opacity-50 disabled:cursor-not-allowed group">
                            <i class="fas fa-sync-alt mr-3 text-slate-500 group-hover:text-slate-700 transition-colors" :class="{ 'fa-spin': labelRegenerating }"></i>
                            <span>Regenerate Labels</span>
                        </button>
                    </div>
                </div>

                <!-- 설정 섹션 -->
                <div v-if="isSidebarOpen" class="space-y-2">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">
                        Settings
                    </h3>
                    <div class="space-y-1">
                        <button @click="toggleModelSelector"
                                class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center group">
                            <i class="fas fa-sliders mr-3 text-slate-500 group-hover:text-slate-700 transition-colors"></i>
                            <span>Model Selection</span>
                        </button>
                        <button @click="refreshModels"
                                :disabled="modelRefreshRunning"
                                class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center disabled:opacity-50 disabled:cursor-not-allowed group">
                            <i class="fas fa-arrows-rotate mr-3 text-slate-500 group-hover:text-slate-700 transition-colors" :class="{ 'fa-spin': modelRefreshRunning }"></i>
                            <span>Model Update</span>
                        </button>
                    </div>
                </div>

                <!-- 시스템 섹션 -->
                <div v-if="isSidebarOpen" class="space-y-2">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">
                        System
                    </h3>
                    <button @click="showLogs"
                            class="w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-sm font-medium transition-all flex items-center group">
                        <i class="fas fa-file-alt mr-3 text-slate-500 group-hover:text-slate-700 transition-colors"></i>
                        <span>View Logs</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- 메인 컨텐츠 (중앙 정렬, 사이드바에 따라 이동) -->
        <div class="transition-all duration-300" :style="{ marginLeft: isSidebarOpen ? '288px' : '64px' }">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <main class="min-w-0 max-w-6xl mx-auto">
            <div>
                <!-- 탭 + 라벨 필터 (서로 다른 줄) -->
                <div class="mb-6 space-y-3">
                    <!-- 1) 이벤트 필터 탭 -->
                    <div class="flex">
                        <div class="flex flex-wrap space-x-1 bg-slate-100 p-1 rounded-xl w-fit max-w-full">
                            <button v-for="tab in tabs" :key="tab.id"
                                    @click="currentTab = tab.id"
                                    class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                    :class="currentTab === tab.id ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                                {{ tab.label }}
                                <span v-if="tab.count !== undefined"
                                      class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold"
                                      :class="tab.countClass">
                                    {{ tab.count }}
                                </span>
                            </button>
                        </div>
                    </div>

                    <!-- 2) 라벨 필터 탭 -->
                    <div v-if="currentTab === 'all' || currentTab === 'classified' || currentTab === 'manual_labeled' || currentTab === 'synthetic'" class="flex">
                        <div class="flex flex-nowrap gap-1 bg-slate-100 p-1 rounded-xl w-fit max-w-full overflow-x-auto">
                            <button
                                @click="clearLabelFilters"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                :class="selectedLabels.length === 0 ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                                All
                                <span class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold bg-slate-200 text-slate-700">
                                    {{ stats.total_images || 0 }}
                                </span>
                            </button>
                            <button
                                @click="toggleLabelFilter('person')"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                :class="selectedLabels.includes('person') ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                                Person
                                <span class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold bg-blue-100 text-blue-700">
                                    {{ stats.by_class?.person || 0 }}
                                </span>
                            </button>
                            <button
                                @click="toggleLabelFilter('cat')"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                :class="selectedLabels.includes('cat') ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                                Cat
                                <span class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold bg-orange-100 text-orange-700">
                                    {{ stats.by_class?.cat || 0 }}
                                </span>
                            </button>
                            <button
                                @click="toggleLabelFilter('background')"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                :class="selectedLabels.includes('background') ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                                Background
                                <span class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold bg-slate-200 text-slate-700">
                                    {{ stats.by_class?.background || stats.by_class?.null || 0 }}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 이벤트 그리드 -->
                <div v-if="loading" class="flex justify-center py-20">
                    <div class="flex flex-col items-center">
                        <div class="w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                        <span class="text-slate-500 font-medium">Loading events...</span>
                    </div>
                </div>
                
                <div v-else-if="events.length === 0" class="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-inbox text-3xl text-slate-400"></i>
                    </div>
                    <h3 class="text-lg font-medium text-slate-800 mb-1">No events found</h3>
                    <p class="text-slate-500">There are no events to display in this category.</p>
                </div>

                <div v-else class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <div v-for="event in events" :key="event.event_id"
                         class="bg-white rounded-xl overflow-hidden cursor-pointer hover:shadow-lg transition-all duration-300 border border-slate-100 group"
                         @click="openEventModal(event)">
                        <div class="relative overflow-hidden">
                            <img :src="event.image_url" 
                                 :alt="event.event_id"
                                 @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Crect fill=%22%23f1f5f9%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2220%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'"
                                 class="w-full h-48 object-cover transform group-hover:scale-105 transition-transform duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            
                            <!-- 상태 배지 -->
                            <span class="absolute top-3 right-3 px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide shadow-sm backdrop-blur-sm"
                                  :class="getStatusClass(event.status)">
                                {{ getStatusLabel(event.status) }}
                            </span>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-3">
                            <span class="text-xs text-slate-400 font-medium flex items-center">
                                <i class="far fa-clock mr-1"></i>
                                <span v-html="formatEventTime(event.event_id)"></span>
                            </span>
                            <!-- <span v-if="event.is_synthetic" 
                                  class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs font-bold border border-purple-200">
                                <i class="fas fa-flask mr-1"></i>SYNTHETIC
                            </span> -->
                        </div>
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="px-2 py-1 rounded-md text-xs font-semibold border flex items-center"
                                  :class="getFrigateConfidenceClass(event)"
                                  title="Frigate Detection">
                                <span class="mr-1.5 opacity-70">F:</span>
                                <i :class="getLabelIcon(event.frigate_label)"></i>
                            </span>
                            <span v-if="event.gemini_label" 
                                    class="px-2 py-1 rounded-md text-xs font-semibold border flex items-center"
                                    :class="getConfidenceClass(event)"
                                    title="Gemini Analysis">
                                <span class="mr-1.5 opacity-70">G:</span>
                                <i :class="getLabelIcon(event.gemini_label)"></i>
                            </span>
                        </div>
                        <div v-if="event.final_label" class="pt-3 border-t border-slate-50">
                            <span class="block text-center py-1.5 rounded-lg text-xs font-bold uppercase tracking-wide flex items-center justify-center"
                                  :class="getLabelClass(event.final_label)">
                                <i :class="getLabelIcon(event.final_label)" class="mr-1.5"></i>
                                {{ event.final_label }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div v-if="totalEvents > limit" class="flex justify-center mt-10 space-x-2">
                <button @click="prevPage" 
                        :disabled="offset === 0"
                        class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 hover:border-blue-300 hover:text-blue-600 text-slate-600 transition-all shadow-sm">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="px-6 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg text-slate-600 font-medium text-sm shadow-sm">
                    {{ Math.floor(offset / limit) + 1 }} <span class="text-slate-300 mx-2">/</span> {{ Math.ceil(totalEvents / limit) }}
                </span>
                <button @click="nextPage" 
                        :disabled="offset + limit >= totalEvents"
                        class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 hover:border-blue-300 hover:text-blue-600 text-slate-600 transition-all shadow-sm">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- 이벤트 상세 모달 -->
        <div v-if="selectedEvent" 
             class="fixed inset-0 z-50 flex items-center justify-center modal-overlay p-4"
             @click.self="selectedEvent = null">
            <div class="bg-white rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transform transition-all">
                <!-- 모달 헤더 -->
                <div class="flex justify-between items-center p-6 border-b border-slate-100 sticky top-0 bg-white z-10">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">Event Details</h3>
                        <p class="text-xs text-slate-400 font-mono mt-1">{{ selectedEvent.event_id }}</p>
                    </div>
                    <button @click="selectedEvent = null" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:bg-slate-200 hover:text-slate-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- 모달 내용 -->
                <div class="p-6">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- 이미지 -->
                        <div class="space-y-4">
                            <div class="rounded-xl overflow-hidden border border-slate-200 shadow-sm bg-slate-50 relative group">
                                <div class="relative inline-block w-full">
                                    <img :src="selectedEvent.image_url" 
                                         @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 800 600%22%3E%3Crect fill=%22%23f1f5f9%22 width=%22800%22 height=%22600%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2224%22 dy=%22.3em%22%3ESnapshot not downloaded%3C/text%3E%3C/svg%3E'"
                                         @load="onImageLoad($event)"
                                         ref="modalImage"
                                         class="w-full h-auto object-contain">
                                    <canvas ref="boxCanvas" 
                                            class="absolute top-0 left-0 w-full h-full pointer-events-none"
                                            style="image-rendering: crisp-edges;"></canvas>
                                </div>
                                <a :href="selectedEvent.image_url" target="_blank" 
                                   class="absolute bottom-3 right-3 w-8 h-8 bg-white/90 backdrop-blur rounded-lg flex items-center justify-center text-slate-600 hover:text-blue-600 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-expand"></i>
                                </a>
                            </div>
                            <!-- 해상도 표시 (이미지 하단) -->
                            <div v-if="imageResolution" class="flex justify-end px-1">
                                <span class="text-xs text-slate-400 font-mono flex items-center">
                                    <i class="fas fa-ruler-combined mr-1.5 opacity-70"></i>
                                    {{ imageResolution }}
                                </span>
                            </div>
                        </div>
                        
                        <!-- 정보 -->
                        <div class="space-y-6">
                            <!-- Synthetic 배지 -->
                            <div v-if="selectedEvent.is_synthetic" 
                                 class="bg-purple-50 border border-purple-200 rounded-xl p-4">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-flask text-purple-600"></i>
                                    <span class="text-purple-700 font-bold text-sm">SYNTHETIC</span>
                                </div>
                                <p v-if="selectedEvent.source_event_id" class="text-xs text-purple-600 mt-2">
                                    Source: {{ selectedEvent.source_event_id }}
                                </p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-1">Status</label>
                                    <span class="inline-block px-2.5 py-1 rounded-md text-xs font-bold uppercase tracking-wide" 
                                             :class="getStatusClass(selectedEvent.status)">
                                        {{ getStatusLabel(selectedEvent.status) }}
                                    </span>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-1">Created At</label>
                                    <p class="text-sm font-medium text-slate-700">{{ formatDate(selectedEvent.created_at) }}</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <h4 class="text-sm font-semibold text-slate-700 uppercase tracking-wide border-b border-slate-100 pb-2">Classification Results</h4>
                                
                                <div class="flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg">
                                    <span class="text-sm text-slate-500">Frigate Detection</span>
                                    <div class="flex items-center space-x-2">
                                        <span v-if="typeof selectedEvent.frigate_confidence === 'number'" class="text-xs text-slate-400 font-medium">
                                            {{ (selectedEvent.frigate_confidence * 100).toFixed(1) }}%
                                        </span>
                                        <span class="px-3 py-1 rounded-md text-xs font-bold border"
                                              :class="getFrigateConfidenceClass(selectedEvent)">
                                            {{ selectedEvent.frigate_label }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div v-if="selectedEvent.gemini_label" class="flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg">
                                    <span class="text-sm text-slate-500">Gemini Analysis</span>
                                    <div class="flex items-center space-x-2">
                                        <span v-if="selectedEvent.gemini_confidence" class="text-xs text-slate-400 font-medium">
                                            {{ selectedEvent.gemini_confidence }}
                                        </span>
                                        <span class="px-3 py-1 rounded-md bg-teal-50 text-teal-700 text-xs font-bold border border-teal-100">
                                            {{ selectedEvent.gemini_label }}
                                        </span>
                                    </div>
                                </div>

                                <div v-if="selectedEvent.final_label" class="flex items-center justify-between p-3 bg-slate-50 border border-slate-200 rounded-lg">
                                    <span class="text-sm font-bold text-slate-700">Final Verdict</span>
                                    <span class="px-3 py-1 rounded-md text-xs font-bold uppercase tracking-wide" 
                                         :class="getLabelClass(selectedEvent.final_label)">
                                    {{ selectedEvent.final_label }}
                                </span>
                                </div>
                            </div>
                            
                            <div v-if="selectedEvent.error_message" class="p-4 bg-rose-50 border border-rose-100 rounded-xl">
                                <label class="text-rose-400 text-xs font-bold uppercase tracking-wider block mb-1">Error Message</label>
                                <p class="text-sm text-rose-600">{{ selectedEvent.error_message }}</p>
                            </div>
                            
                            <!-- 수동 라벨링 (항상 표시) -->
                            <div class="pt-6 border-t border-slate-100">
                                <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-3">Manual Labeling</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button @click="labelEvent('person')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-blue-300 hover:bg-blue-50 text-slate-600 hover:text-blue-600 rounded-xl transition-all group">
                                        <i class="fas fa-user text-xl mb-1 text-slate-400 group-hover:text-blue-500"></i>
                                        <span class="text-xs font-medium">Person</span>
                                    </button>
                                    <button @click="labelEvent('cat')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-orange-300 hover:bg-orange-50 text-slate-600 hover:text-orange-600 rounded-xl transition-all group">
                                        <i class="fas fa-cat text-xl mb-1 text-slate-400 group-hover:text-orange-500"></i>
                                        <span class="text-xs font-medium">Cat</span>
                                    </button>
                                    <button @click="labelEvent('background')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-slate-400 hover:bg-slate-100 text-slate-600 hover:text-slate-800 rounded-xl transition-all group">
                                        <i class="fas fa-ban text-xl mb-1 text-slate-400 group-hover:text-slate-600"></i>
                                        <span class="text-xs font-medium">Background</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 액션 버튼 -->
                            <div class="flex space-x-3 pt-6 border-t border-slate-100">
                                <button v-if="['gemini_error', 'pending'].includes(selectedEvent.status)"
                                        @click="retryGemini"
                                        class="flex-1 px-4 py-2.5 bg-blue-50 hover:bg-blue-100 text-blue-600 border border-blue-200 rounded-lg text-sm font-medium transition-colors flex items-center justify-center">
                                    <i class="fas fa-redo mr-2"></i>Retry Analysis
                                </button>
                                <button @click="deleteEvent"
                                        class="flex-1 px-4 py-2.5 bg-white hover:bg-rose-50 text-rose-600 border border-slate-200 hover:border-rose-200 rounded-lg text-sm font-medium transition-colors flex items-center justify-center">
                                    <i class="fas fa-trash mr-2"></i>Delete Event
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 모델 선택 모달 -->
        <div v-if="showModelSelector" 
             class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
             @click.self="closeModelSelector">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl flex flex-col">
                <!-- 헤더 -->
                <div class="px-8 py-6 border-b border-slate-200 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Gemini Model Selection</h2>
                        <p class="text-sm text-slate-500 mt-1">Choose the AI model for classification</p>
                    </div>
                    <button @click="closeModelSelector" 
                            class="w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- 내용 -->
                <div class="p-8">
                    <div v-if="modelSelectorLoading" class="flex items-center justify-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    </div>
                    <div v-else class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Model Family</label>
                            <select v-model="selectedFamily"
                                    @change="onFamilyChanged"
                                    class="w-full px-4 py-3 bg-white border border-slate-200 rounded-lg text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option disabled value="">Please select a family</option>
                                <option v-for="f in modelFamilies" :key="f.family" :value="f.family">
                                    {{ f.family }} (Current: {{ f.selected_model_name || 'Not set' }})
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Model Version</label>
                            <select v-model="selectedModel"
                                    :disabled="!selectedFamily"
                                    class="w-full px-4 py-3 bg-white border border-slate-200 rounded-lg text-sm text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option disabled value="">Please select a model</option>
                                <option v-for="o in modelOptions" :key="o.model_name" :value="o.model_name">
                                    {{ o.model_name }} (mm: {{ o.multimodal_status || 'unknown' }})
                                </option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 푸터 -->
                <div class="px-8 py-4 border-t border-slate-200 flex justify-end space-x-3">
                    <button @click="reloadModelSelector" 
                            :disabled="modelSelectorLoading"
                            class="px-4 py-2 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 rounded-lg text-sm font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-sync-alt mr-2"></i>Reload
                    </button>
                    <button @click="closeModelSelector" 
                            class="px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition-all">
                        Cancel
                    </button>
                    <button @click="applyModelSelection" 
                            :disabled="modelSelectorLoading || !selectedFamily || !selectedModel"
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-check mr-2"></i>Apply
                    </button>
                </div>
            </div>
        </div>

        <!-- 로그 모달 -->
        <div v-if="showLogModal" 
             class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
             @click.self="showLogModal = false">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
                <!-- 헤더 -->
                <div class="px-8 py-6 border-b border-slate-200 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">System Logs</h2>
                        <p class="text-sm text-slate-500 mt-1">Recent {{ logs.length }} lines</p>
                    </div>
                    <button @click="showLogModal = false" 
                            class="w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- 로그 내용 -->
                <div class="flex-1 overflow-auto p-8">
                    <div v-if="logsLoading" class="flex items-center justify-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    </div>
                    <div v-else-if="logs.length === 0" class="text-center py-12 text-slate-400">
                        <i class="fas fa-file-alt text-4xl mb-4"></i>
                        <p>No logs available</p>
                    </div>
                    <pre v-else class="bg-slate-900 text-green-400 p-6 rounded-xl text-xs font-mono overflow-x-auto whitespace-pre-wrap break-words leading-relaxed">{{ logs.join('\n') }}</pre>
                </div>

                <!-- 푸터 -->
                <div class="px-8 py-4 border-t border-slate-200 flex justify-end space-x-3">
                    <button @click="fetchLogs" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-all">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                    <button @click="showLogModal = false" 
                            class="px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition-all">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 토스트 알림 -->
        <transition name="toast">
            <div v-if="toastVisible && toastMessage"
                 class="fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-2xl z-[9999] flex items-center space-x-3 border bg-white"
                 :class="toastType === 'success' ? 'border-emerald-100 text-emerald-800' : 'border-rose-100 text-rose-800'">
                <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
                     :class="toastType === 'success' ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'">
                    <i class="fas" :class="toastType === 'success' ? 'fa-check' : 'fa-exclamation'"></i>
                </div>
                <div class="font-medium">{{ toastMessage }}</div>
            </div>
        </transition>

            </main>
        </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
