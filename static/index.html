<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Cat 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen font-sans antialiased">
    <div id="app" v-cloak>
        <!-- 네비게이션 -->
        <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 py-4 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                        <i class="fas fa-cat mr-2 text-blue-600"></i>Anti-Cat
                    </h1>
                    <span class="px-3 py-1 text-xs font-semibold rounded-full border" 
                          :class="processorRunning ? 'bg-emerald-50 text-emerald-600 border-emerald-200' : 'bg-rose-50 text-rose-600 border-rose-200'">
                        <span class="w-2 h-2 rounded-full inline-block mr-1" :class="processorRunning ? 'bg-emerald-500' : 'bg-rose-500'"></span>
                        {{ processorRunning ? 'System Active' : 'System Paused' }}
                    </span>
                </div>
                <div class="flex items-center space-x-3">
                    <button @click="showLogs" 
                            class="px-4 py-2 bg-white border border-slate-200 hover:border-amber-300 hover:text-amber-600 text-slate-600 rounded-lg text-sm font-medium transition-all shadow-sm hover:shadow flex items-center group">
                        <i class="fas fa-file-alt mr-2 text-slate-400 group-hover:text-amber-500 transition-colors"></i>
                        View Logs
                    </button>
                </div>
            </div>
        </nav>

        <div class="flex max-w-7xl mx-auto px-6 py-8 gap-6">
            <!-- 좌측 사이드바 -->
            <aside class="flex-shrink-0 space-y-6 transition-all duration-300" :class="isSidebarOpen ? 'w-80' : 'w-20'">
                <!-- Toggle Button -->
                <div class="flex" :class="isSidebarOpen ? 'justify-end' : 'justify-center'">
                    <button @click="isSidebarOpen = !isSidebarOpen" class="p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors">
                        <i class="fas" :class="isSidebarOpen ? 'fa-chevron-left' : 'fa-bars'"></i>
                    </button>
                </div>

                <!-- 통계 카드 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-100" :class="isSidebarOpen ? 'p-5' : 'p-3 flex flex-col items-center'">
                    <h3 v-if="isSidebarOpen" class="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fas fa-chart-pie mr-2 text-slate-400"></i>
                        통계
                    </h3>
                    <div v-if="isSidebarOpen" class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-500">Total Images</span>
                            <span class="text-lg font-bold text-slate-800">{{ stats.total_images }}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-500">Classified</span>
                            <span class="text-lg font-bold text-emerald-600">{{ stats.by_status?.classified || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-500">Manual Labeled</span>
                            <span class="text-lg font-bold text-blue-600">{{ stats.by_status?.manual_labeled || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-500">Mismatched</span>
                            <span class="text-lg font-bold text-amber-500">{{ stats.by_status?.mismatched || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-500">Errors</span>
                            <span class="text-lg font-bold text-rose-500">{{ stats.by_status?.gemini_error || 0 }}</span>
                        </div>
                        <div class="border-t border-slate-100 pt-3 mt-3">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-slate-500">Person</span>
                                <span class="text-base font-semibold text-blue-600">{{ stats.by_class?.person || 0 }}</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-slate-500">Cat</span>
                                <span class="text-base font-semibold text-orange-600">{{ stats.by_class?.cat || 0 }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-500">Background</span>
                                <span class="text-base font-semibold text-slate-600">{{ stats.by_class?.background || stats.by_class?.null || 0 }}</span>
                            </div>
                        </div>
                    </div>
                    <div v-else class="flex flex-col items-center space-y-4 w-full">
                        <div class="text-center group relative cursor-help">
                            <i class="fas fa-images text-slate-400 text-lg mb-1"></i>
                            <div class="text-xs font-bold">{{ stats.total_images }}</div>
                        </div>
                        <div class="w-full border-t border-slate-100"></div>
                        <div class="text-center text-emerald-600 font-bold text-xs" title="Classified">{{ stats.by_status?.classified || 0 }}</div>
                        <div class="text-center text-blue-600 font-bold text-xs" title="Manual">{{ stats.by_status?.manual_labeled || 0 }}</div>
                        <div class="text-center text-amber-500 font-bold text-xs" title="Mismatched">{{ stats.by_status?.mismatched || 0 }}</div>
                    </div>
                </div>

                <!-- 작업 섹션 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-100" :class="isSidebarOpen ? 'p-5' : 'p-3 flex flex-col items-center'">
                    <h3 v-if="isSidebarOpen" class="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fas fa-play-circle mr-2 text-slate-400"></i>
                        작업
                    </h3>
                    <button @click="triggerDailyRoutine" 
                            :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                            class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-all shadow-sm flex items-center justify-center"
                            :title="!isSidebarOpen ? 'Run Routine' : ''">
                        <i class="fas fa-play" :class="isSidebarOpen ? 'mr-2' : ''"></i>
                        <span v-if="isSidebarOpen">Run Routine</span>
                    </button>
                </div>

                <!-- 데이터 관리 섹션 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-100" :class="isSidebarOpen ? 'p-5' : 'p-3 flex flex-col items-center'">
                    <h3 v-if="isSidebarOpen" class="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fas fa-database mr-2 text-slate-400"></i>
                        데이터 관리
                    </h3>
                    <div class="space-y-2" :class="!isSidebarOpen ? 'w-full flex flex-col items-center' : ''">
                        <button @click="exportDataset" 
                                :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                                class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 rounded-lg text-sm font-medium transition-all shadow-sm hover:shadow-md flex items-center justify-center"
                                :title="!isSidebarOpen ? 'Export Dataset' : ''">
                            <i class="fas fa-download" :class="isSidebarOpen ? 'mr-2' : ''"></i>
                            <span v-if="isSidebarOpen">Export Dataset</span>
                        </button>
                        <button @click="regenerateLabels" 
                                :disabled="labelRegenerating"
                                :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                                class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 rounded-lg text-sm font-medium transition-all shadow-sm hover:shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                                :title="!isSidebarOpen ? 'Regen Labels' : ''">
                            <i class="fas fa-sync-alt" :class="[{ 'fa-spin': labelRegenerating }, isSidebarOpen ? 'mr-2' : '']"></i>
                            <span v-if="isSidebarOpen">Regen Labels</span>
                        </button>
                        <button @click="recalculateBoundBoxes" 
                                :disabled="boundBoxRecalculating"
                                :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                                class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 disabled:bg-slate-50 disabled:text-slate-400 rounded-lg text-sm font-medium transition-all shadow-sm hover:shadow-md flex items-center justify-center"
                                :title="!isSidebarOpen ? 'Recalc Boxes' : ''">
                            <i :class="boundBoxRecalculating ? 'fas fa-spinner fa-spin' : 'fas fa-calculator'" :class="isSidebarOpen ? 'mr-2' : ''"></i>
                            <span v-if="isSidebarOpen">{{ boundBoxRecalculating ? 'Calculating...' : 'Recalc Boxes' }}</span>
                        </button>
                    </div>
                </div>

                <!-- 설정 섹션 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-100" :class="isSidebarOpen ? 'p-5' : 'p-3 flex flex-col items-center'">
                    <h3 v-if="isSidebarOpen" class="text-sm font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fas fa-cog mr-2 text-slate-400"></i>
                        설정
                    </h3>
                    <div class="space-y-2" :class="!isSidebarOpen ? 'w-full flex flex-col items-center' : ''">
                        <button @click="refreshModels"
                                :disabled="modelRefreshRunning"
                                :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                                class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 disabled:bg-slate-50 disabled:text-slate-400 rounded-lg text-sm font-medium transition-all shadow-sm flex items-center justify-center disabled:cursor-not-allowed"
                                :title="!isSidebarOpen ? '모델 업데이트' : ''">
                            <i class="fas fa-arrows-rotate" :class="[{ 'fa-spin': modelRefreshRunning }, isSidebarOpen ? 'mr-2' : '']"></i>
                            <span v-if="isSidebarOpen">모델 업데이트</span>
                        </button>
                        <div class="relative" :class="!isSidebarOpen ? 'w-full flex justify-center' : ''">
                            <button @click="toggleModelSelector"
                                    :class="isSidebarOpen ? 'w-full px-4 py-2.5' : 'w-10 h-10 rounded-full p-0'"
                                    class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 rounded-lg text-sm font-medium transition-all shadow-sm flex items-center justify-center"
                                    :title="!isSidebarOpen ? '모델 선택' : ''">
                                <i class="fas fa-sliders" :class="isSidebarOpen ? 'mr-2' : ''"></i>
                                <span v-if="isSidebarOpen">모델 선택</span>
                            </button>

                            <!-- 모델 선택 드롭다운 -->
                            <div v-if="showModelSelector"
                                 class="absolute mt-2 min-w-[28rem] bg-white border border-slate-200 rounded-xl shadow-lg p-4 z-50"
                                 :class="isSidebarOpen ? 'left-0 w-full top-full' : 'left-full ml-2 top-0'">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-sm font-bold text-slate-800">Gemini 모델 선택</div>
                                    <button @click="closeModelSelector"
                                            class="w-8 h-8 flex items-center justify-center rounded-lg bg-slate-100 text-slate-500 hover:bg-slate-200 hover:text-slate-700 transition-colors">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 mb-1">Family (x.y)</label>
                                        <select v-model="selectedFamily"
                                                @change="onFamilyChanged"
                                                class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-200">
                                            <option disabled value="">선택하세요</option>
                                            <option v-for="f in modelFamilies" :key="f.family" :value="f.family">
                                                {{ f.family }} (현재: {{ f.selected_model_name || '미설정' }})
                                            </option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 mb-1">Model</label>
                                        <select v-model="selectedModel"
                                                :disabled="!selectedFamily"
                                                class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-slate-200">
                                            <option disabled value="">선택하세요</option>
                                            <option v-for="o in modelOptions" :key="o.model_name" :value="o.model_name">
                                                {{ o.model_name }} (mm: {{ o.multimodal_status || 'unknown' }})
                                            </option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flex items-center justify-end mt-4 space-x-2">
                                    <button @click="reloadModelSelector" :disabled="modelSelectorLoading"
                                            class="px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                        새로고침
                                    </button>
                                    <button @click="applyModelSelection" :disabled="modelSelectorLoading || !selectedFamily || !selectedModel"
                                            class="px-3 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed">
                                        적용
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 메인 컨텐츠 -->
            <main class="flex-1 min-w-0">
            <div>
                <!-- 탭 메뉴 -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex space-x-1 bg-slate-100 p-1 rounded-xl">
                        <button v-for="tab in tabs" :key="tab.id"
                                @click="currentTab = tab.id"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center"
                                :class="currentTab === tab.id ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                            {{ tab.label }}
                            <span v-if="tab.count !== undefined"
                                  class="ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold"
                                  :class="tab.countClass">
                                {{ tab.count }}
                            </span>
                        </button>
                    </div>

                    <!-- 라벨 필터 -->
                    <div class="pb-3" v-if="currentTab === 'all' || currentTab === 'classified' || currentTab === 'synthetic'">
                        <select v-model="selectedLabelFilter" @change="onFilterChange" 
                                class="px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-100 cursor-pointer hover:border-slate-300 transition-colors">
                            <option value="">All Labels</option>
                            <option value="person">Person</option>
                            <option value="cat">Cat</option>
                            <option value="background">Background</option>
                        </select>
                    </div>
                </div>

                <!-- 이벤트 그리드 -->
                <div v-if="loading" class="flex justify-center py-20">
                    <div class="flex flex-col items-center">
                        <div class="w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                        <span class="text-slate-500 font-medium">Loading events...</span>
                    </div>
                </div>
                
                <div v-else-if="events.length === 0" class="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-inbox text-3xl text-slate-400"></i>
                    </div>
                    <h3 class="text-lg font-medium text-slate-800 mb-1">No events found</h3>
                    <p class="text-slate-500">There are no events to display in this category.</p>
                </div>

                <div v-else class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <div v-for="event in events" :key="event.event_id"
                         class="bg-white rounded-xl overflow-hidden cursor-pointer hover:shadow-lg transition-all duration-300 border border-slate-100 group"
                         @click="openEventModal(event)">
                        <div class="relative overflow-hidden">
                            <img :src="event.image_url" 
                                 :alt="event.event_id"
                                 @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Crect fill=%22%23f1f5f9%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2220%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'"
                                 class="w-full h-48 object-cover transform group-hover:scale-105 transition-transform duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            
                            <!-- 상태 배지 -->
                            <span class="absolute top-3 right-3 px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide shadow-sm backdrop-blur-sm"
                                  :class="getStatusClass(event.status)">
                                {{ getStatusLabel(event.status) }}
                            </span>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-3">
                            <span class="text-xs text-slate-400 font-medium flex items-center">
                                <i class="far fa-clock mr-1"></i>
                                <span v-html="formatEventTime(event.event_id)"></span>
                            </span>
                            <!-- <span v-if="event.is_synthetic" 
                                  class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs font-bold border border-purple-200">
                                <i class="fas fa-flask mr-1"></i>SYNTHETIC
                            </span> -->
                        </div>
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="px-2 py-1 rounded-md text-xs font-semibold border flex items-center"
                                  :class="getFrigateConfidenceClass(event)"
                                  title="Frigate Detection">
                                <span class="mr-1.5 opacity-70">F:</span>
                                <i :class="getLabelIcon(event.frigate_label)"></i>
                            </span>
                            <span v-if="event.gemini_label" 
                                    class="px-2 py-1 rounded-md text-xs font-semibold border flex items-center"
                                    :class="getConfidenceClass(event)"
                                    title="Gemini Analysis">
                                <span class="mr-1.5 opacity-70">G:</span>
                                <i :class="getLabelIcon(event.gemini_label)"></i>
                            </span>
                        </div>
                        <div v-if="event.final_label" class="pt-3 border-t border-slate-50">
                            <span class="block text-center py-1.5 rounded-lg text-xs font-bold uppercase tracking-wide flex items-center justify-center"
                                  :class="getLabelClass(event.final_label)">
                                <i :class="getLabelIcon(event.final_label)" class="mr-1.5"></i>
                                {{ event.final_label }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div v-if="totalEvents > limit" class="flex justify-center mt-10 space-x-2">
                <button @click="prevPage" 
                        :disabled="offset === 0"
                        class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 hover:border-blue-300 hover:text-blue-600 text-slate-600 transition-all shadow-sm">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="px-6 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg text-slate-600 font-medium text-sm shadow-sm">
                    {{ Math.floor(offset / limit) + 1 }} <span class="text-slate-300 mx-2">/</span> {{ Math.ceil(totalEvents / limit) }}
                </span>
                <button @click="nextPage" 
                        :disabled="offset + limit >= totalEvents"
                        class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 hover:border-blue-300 hover:text-blue-600 text-slate-600 transition-all shadow-sm">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- 이벤트 상세 모달 -->
        <div v-if="selectedEvent" 
             class="fixed inset-0 z-50 flex items-center justify-center modal-overlay p-4"
             @click.self="selectedEvent = null">
            <div class="bg-white rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transform transition-all">
                <!-- 모달 헤더 -->
                <div class="flex justify-between items-center p-6 border-b border-slate-100 sticky top-0 bg-white z-10">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">Event Details</h3>
                        <p class="text-xs text-slate-400 font-mono mt-1">{{ selectedEvent.event_id }}</p>
                    </div>
                    <button @click="selectedEvent = null" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:bg-slate-200 hover:text-slate-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- 모달 내용 -->
                <div class="p-6">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- 이미지 -->
                        <div class="space-y-4">
                            <div class="rounded-xl overflow-hidden border border-slate-200 shadow-sm bg-slate-50 relative group">
                                <div class="relative inline-block w-full">
                                    <img :src="selectedEvent.image_url" 
                                         @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 800 600%22%3E%3Crect fill=%22%23f1f5f9%22 width=%22800%22 height=%22600%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2224%22 dy=%22.3em%22%3ESnapshot not downloaded%3C/text%3E%3C/svg%3E'"
                                         @load="onImageLoad($event)"
                                         ref="modalImage"
                                         class="w-full h-auto object-contain">
                                    <canvas ref="boxCanvas" 
                                            class="absolute top-0 left-0 w-full h-full pointer-events-none"
                                            style="image-rendering: crisp-edges;"></canvas>
                                </div>
                                <a :href="selectedEvent.image_url" target="_blank" 
                                   class="absolute bottom-3 right-3 w-8 h-8 bg-white/90 backdrop-blur rounded-lg flex items-center justify-center text-slate-600 hover:text-blue-600 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-expand"></i>
                                </a>
                            </div>
                            <!-- 해상도 표시 (이미지 하단) -->
                            <div v-if="imageResolution" class="flex justify-end px-1">
                                <span class="text-xs text-slate-400 font-mono flex items-center">
                                    <i class="fas fa-ruler-combined mr-1.5 opacity-70"></i>
                                    {{ imageResolution }}
                                </span>
                            </div>
                        </div>
                        
                        <!-- 정보 -->
                        <div class="space-y-6">
                            <!-- Synthetic 배지 -->
                            <div v-if="selectedEvent.is_synthetic" 
                                 class="bg-purple-50 border border-purple-200 rounded-xl p-4">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-flask text-purple-600"></i>
                                    <span class="text-purple-700 font-bold text-sm">SYNTHETIC</span>
                                </div>
                                <p v-if="selectedEvent.source_event_id" class="text-xs text-purple-600 mt-2">
                                    Source: {{ selectedEvent.source_event_id }}
                                </p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-1">Status</label>
                                    <span class="inline-block px-2.5 py-1 rounded-md text-xs font-bold uppercase tracking-wide" 
                                             :class="getStatusClass(selectedEvent.status)">
                                        {{ getStatusLabel(selectedEvent.status) }}
                                    </span>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-1">Created At</label>
                                    <p class="text-sm font-medium text-slate-700">{{ formatDate(selectedEvent.created_at) }}</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <h4 class="text-sm font-semibold text-slate-700 uppercase tracking-wide border-b border-slate-100 pb-2">Classification Results</h4>
                                
                                <div class="flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg">
                                    <span class="text-sm text-slate-500">Frigate Detection</span>
                                    <div class="flex items-center space-x-2">
                                        <span v-if="typeof selectedEvent.frigate_confidence === 'number'" class="text-xs text-slate-400 font-medium">
                                            {{ (selectedEvent.frigate_confidence * 100).toFixed(1) }}%
                                        </span>
                                        <span class="px-3 py-1 rounded-md text-xs font-bold border"
                                              :class="getFrigateConfidenceClass(selectedEvent)">
                                            {{ selectedEvent.frigate_label }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div v-if="selectedEvent.gemini_label" class="flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg">
                                    <span class="text-sm text-slate-500">Gemini Analysis</span>
                                    <div class="flex items-center space-x-2">
                                        <span v-if="selectedEvent.gemini_confidence" class="text-xs text-slate-400 font-medium">
                                            {{ selectedEvent.gemini_confidence }}
                                        </span>
                                        <span class="px-3 py-1 rounded-md bg-teal-50 text-teal-700 text-xs font-bold border border-teal-100">
                                            {{ selectedEvent.gemini_label }}
                                        </span>
                                    </div>
                                </div>

                                <div v-if="selectedEvent.final_label" class="flex items-center justify-between p-3 bg-slate-50 border border-slate-200 rounded-lg">
                                    <span class="text-sm font-bold text-slate-700">Final Verdict</span>
                                    <span class="px-3 py-1 rounded-md text-xs font-bold uppercase tracking-wide" 
                                         :class="getLabelClass(selectedEvent.final_label)">
                                    {{ selectedEvent.final_label }}
                                </span>
                                </div>
                            </div>
                            
                            <div v-if="selectedEvent.error_message" class="p-4 bg-rose-50 border border-rose-100 rounded-xl">
                                <label class="text-rose-400 text-xs font-bold uppercase tracking-wider block mb-1">Error Message</label>
                                <p class="text-sm text-rose-600">{{ selectedEvent.error_message }}</p>
                            </div>
                            
                            <!-- 수동 라벨링 (항상 표시) -->
                            <div class="pt-6 border-t border-slate-100">
                                <label class="text-slate-400 text-xs font-bold uppercase tracking-wider block mb-3">Manual Labeling</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button @click="labelEvent('person')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-blue-300 hover:bg-blue-50 text-slate-600 hover:text-blue-600 rounded-xl transition-all group">
                                        <i class="fas fa-user text-xl mb-1 text-slate-400 group-hover:text-blue-500"></i>
                                        <span class="text-xs font-medium">Person</span>
                                    </button>
                                    <button @click="labelEvent('cat')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-orange-300 hover:bg-orange-50 text-slate-600 hover:text-orange-600 rounded-xl transition-all group">
                                        <i class="fas fa-cat text-xl mb-1 text-slate-400 group-hover:text-orange-500"></i>
                                        <span class="text-xs font-medium">Cat</span>
                                    </button>
                                    <button @click="labelEvent('background')"
                                            class="flex flex-col items-center justify-center p-3 bg-white border border-slate-200 hover:border-slate-400 hover:bg-slate-100 text-slate-600 hover:text-slate-800 rounded-xl transition-all group">
                                        <i class="fas fa-ban text-xl mb-1 text-slate-400 group-hover:text-slate-600"></i>
                                        <span class="text-xs font-medium">Background</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 액션 버튼 -->
                            <div class="flex space-x-3 pt-6 border-t border-slate-100">
                                <button v-if="['gemini_error', 'pending'].includes(selectedEvent.status)"
                                        @click="retryGemini"
                                        class="flex-1 px-4 py-2.5 bg-blue-50 hover:bg-blue-100 text-blue-600 border border-blue-200 rounded-lg text-sm font-medium transition-colors flex items-center justify-center">
                                    <i class="fas fa-redo mr-2"></i>Retry Analysis
                                </button>
                                <button @click="deleteEvent"
                                        class="flex-1 px-4 py-2.5 bg-white hover:bg-rose-50 text-rose-600 border border-slate-200 hover:border-rose-200 rounded-lg text-sm font-medium transition-colors flex items-center justify-center">
                                    <i class="fas fa-trash mr-2"></i>Delete Event
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 로그 모달 -->
        <div v-if="showLogModal" 
             class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
             @click.self="showLogModal = false">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
                <!-- 헤더 -->
                <div class="px-8 py-6 border-b border-slate-200 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">System Logs</h2>
                        <p class="text-sm text-slate-500 mt-1">Recent {{ logs.length }} lines</p>
                    </div>
                    <button @click="showLogModal = false" 
                            class="w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- 로그 내용 -->
                <div class="flex-1 overflow-auto p-8">
                    <div v-if="logsLoading" class="flex items-center justify-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    </div>
                    <div v-else-if="logs.length === 0" class="text-center py-12 text-slate-400">
                        <i class="fas fa-file-alt text-4xl mb-4"></i>
                        <p>No logs available</p>
                    </div>
                    <pre v-else class="bg-slate-900 text-green-400 p-6 rounded-xl text-xs font-mono overflow-x-auto whitespace-pre-wrap break-words leading-relaxed">{{ logs.join('\n') }}</pre>
                </div>

                <!-- 푸터 -->
                <div class="px-8 py-4 border-t border-slate-200 flex justify-end space-x-3">
                    <button @click="fetchLogs" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-all">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                    <button @click="showLogModal = false" 
                            class="px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition-all">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 토스트 알림 -->
        <transition name="toast">
            <div v-if="toastVisible && toastMessage"
                 class="fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-2xl z-[9999] flex items-center space-x-3 border bg-white"
                 :class="toastType === 'success' ? 'border-emerald-100 text-emerald-800' : 'border-rose-100 text-rose-800'">
                <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
                     :class="toastType === 'success' ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'">
                    <i class="fas" :class="toastType === 'success' ? 'fa-check' : 'fa-exclamation'"></i>
                </div>
                <div class="font-medium">{{ toastMessage }}</div>
            </div>
        </transition>

            </main>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
